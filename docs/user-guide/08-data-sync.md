# 数据同步与管理

LumosTime 坚持 **本地优先** 策略，数据默认保存在本地。

## 数据导出

在 **设置** → **数据导出/导入** 中管理数据。

### 1. 导出 JSON

**功能：**
- 导出完整的 JSON 格式备份
- 包含所有时间记录、标签、领域、待办、回顾等数据
- 纯文本格式，可用于备份和迁移(图片暂时不支持导出，以后会支持)


### 2. 导出 Excel

**功能：**
- 选择日期范围导出时间记录到 Excel 文件
- 支持快速选择：今天、昨天、本周、上周、本月、上月、今年、全部
- 导出的 Excel 文件包含详细的时间记录信息


### 3. 导出到 Obsidian

**功能：**
- 将时间记录和回顾导出为 Markdown 文件
- 支持自定义路径模板（如 `{YYYY}/{MM}/{YYYY}-{MM}-{DD}.md`）
- 可选择导出内容：时间线、统计、问答、叙事
- 支持导出每日/每周/每月回顾

**配置：**
1. 设置 Obsidian 笔记库根路径
2. 配置每日笔记路径模板
3. 配置每周/每月笔记路径模板（可选）
4. 选择要导出的内容


### 4. 导入 JSON

- 从 JSON 备份文件恢复数据
- 导入前建议先导出当前数据作为备份
- 导入操作不可撤销

## 云端同步

支持两种云端同步方式：

### 1. WebDAV 同步

**配置步骤：**

1. 进入 **设置** → **WebDAV 同步**
2. 填写配置信息：
   - **服务器 URL**：WebDAV 服务器地址（从服务商处获取）
   - **账号**：WebDAV 账号
   - **密码**：WebDAV 密码

**路径配置要求：**

- 不能填写网盘根目录，必须建立一个子文件夹
- 示例：新建文件夹 `LumosTime`，则路径填写 `/LumosTime`
- 在 `LumosTime` 文件夹下，需要手动创建两个子文件夹：
  - `images`：存储图片
  - `backups`：存储备份

### 2. S3 同步

**配置步骤：**

1. 进入 **设置** → **S3 同步**
2. 在云服务商处完成以下操作：
   - 新建一个存储桶（Bucket）
   - 新建一个用户，并将用户权限添加到存储桶
   - 对存储桶进行跨域设置（CORS）
3. 填写配置信息：
   - **Bucket 名称**
   - **Region**
   - **Access Key**
   - **Secret Key**

**注意：**
- 目前仅支持腾讯云对象存储（COS）

## 同步逻辑

### 冲突处理

- 通过比较时间戳实现同步
- 建议尽量不要多端同时登录，以免造成数据冲突
- 如果发生冲突，以时间戳较新的数据为准

### 备份机制

- 每次同步（从云端覆盖本地）之前，系统会先将本地数据上传至云端进行备份
- 备份文件存储在 `backups` 文件夹中
- 备份文件会随着时间积累，可能占用较多空间

### 空间管理

- 在 **设置** → **数据导出导入** → **清理云端备份** 中清空备份文件
- 清理后仅保留最新的一份备份
- 建议定期清理以节省空间

### 图片管理

- 图片存储在 `images` 文件夹下
- 通过图片列表维护图片引用关系
- 如果图片列表损坏，可以在 **设置** → **数据导出/导入** 中进行图片重建
- 图片重建会清理本地未引用或多余的图片

## 数据清理

### 清除数据
- 重置所有数据
- 谨慎操作，建议先导出备份

### 图片重建
- 在 **设置** → **数据导出/导入** 中进行图片重建
- 清理本地未引用或多余的图片
- 修复损坏的图片列表


