# 图片导出导入功能

## 功能概述

为了方便用户备份和迁移图片数据，我们在"数据导出导入"页面中新增了图片导出导入功能。用户可以将所有本地图片打包成ZIP压缩包进行备份，也可以从ZIP文件中恢复图片。

## 功能特性

### 1. 图片导出
- 将所有本地存储的图片（包括原图和缩略图）打包成一个ZIP文件
- 自动命名格式：`lumostime-images-YYYY-MM-DDTHH-mm-ss.zip`
- 支持压缩以减小文件大小（压缩级别：6）
- 显示导出进度和结果统计

### 2. 图片导入
- 从ZIP文件中批量导入图片
- 自动跳过已存在的图片，避免重复导入
- 显示导入结果统计：成功、失败、跳过的数量
- 支持跨平台导入（Web、Android、Electron）

### 3. 智能处理
- 自动处理不同格式的图片数据（Base64、ArrayBuffer、Blob）
- 兼容不同存储方式（IndexedDB for Web, Filesystem for Native/Electron）
- 过滤系统文件（如 `__MACOSX`、隐藏文件）

## 使用方法

### 导出图片

1. 打开应用设置
2. 进入"数据导出导入"页面
3. 在"图片管理"部分找到"图片备份"区域
4. 点击"导出图片"按钮
5. 等待处理完成，ZIP文件会自动下载

### 导入图片

1. 打开应用设置
2. 进入"数据导出导入"页面
3. 在"图片管理"部分找到"图片备份"区域
4. 点击"导入图片"按钮
5. 选择之前导出的ZIP文件
6. 等待导入完成，查看导入结果

## 技术实现

### 核心服务

**imageExportService.ts**
- `exportImagesToZip()`: 导出所有图片为ZIP
- `importImagesFromZip(file)`: 从ZIP导入图片
- `previewZipContents(file)`: 预览ZIP内容（未来可用）

### 依赖库

- **jszip**: 用于创建和解析ZIP文件
- **imageService**: 现有的图片存储服务

### 数据流程

#### 导出流程
```
1. 调用 imageService.listImages() 获取所有图片列表
2. 遍历每个图片，调用 imageService.readImage() 读取数据
3. 将图片数据添加到 JSZip 对象
4. 生成 ZIP Blob
5. 触发浏览器下载
```

#### 导入流程
```
1. 读取用户选择的ZIP文件
2. 使用 JSZip 解析ZIP内容
3. 过滤有效的图片文件
4. 检查是否已存在，跳过重复文件
5. 调用 imageService.writeImage() 写入每个图片
6. 返回导入统计结果
```

## 注意事项

1. **存储空间**: 导出前请确保有足够的存储空间
2. **文件格式**: 导入时只接受 `.zip` 格式的文件
3. **重复处理**: 导入时会自动跳过已存在的图片，不会覆盖
4. **跨平台**: 导出的ZIP文件可以在不同平台间迁移使用

## 未来改进

- [ ] 添加导出前的预览功能，显示将要导出的图片数量和总大小
- [ ] 支持选择性导出（只导出特定日期范围的图片）
- [ ] 添加导入前的预览功能，显示ZIP中的图片列表
- [ ] 支持增量导入（只导入新图片）
- [ ] 添加导出/导入进度条
- [ ] 支持更多压缩格式（如 .tar.gz）

## 相关文件

- `src/services/imageExportService.ts` - 图片导出导入服务
- `src/services/imageService.ts` - 图片存储服务
- `src/views/settings/DataManagementView.tsx` - 数据管理页面UI
- `docs/features/image-export-import.md` - 本文档

## 更新日志

### 2026-02-16
- ✅ 实现基础的图片导出功能
- ✅ 实现基础的图片导入功能
- ✅ 在数据管理页面添加UI
- ✅ 添加导入结果统计
- ✅ 添加重复文件跳过逻辑
