# StatsView.tsx é‡æ„ - é˜¶æ®µ 1-3 å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¥æœŸ**: 2026-02-10  
**å®Œæˆé˜¶æ®µ**: é˜¶æ®µ 1-3ï¼ˆå‡†å¤‡å·¥ä½œ + Hooks æå– + å·¥å…·å‡½æ•°æå–ï¼‰  
**æ€»ä½“è¿›åº¦**: 60% (3/5)

---

## âœ… å·²å®Œæˆå·¥ä½œ

### é˜¶æ®µ 1: å‡†å¤‡å·¥ä½œ âœ…

#### 1.1 æ–‡ä»¶åˆ†æ
- âœ… å®Œæ•´è¯»å– StatsView.tsxï¼ˆ2039 è¡Œï¼‰
- âœ… è¯†åˆ« 5 ç§è§†å›¾ç±»å‹
- âœ… è¯†åˆ« ~300 è¡Œé‡å¤ç»Ÿè®¡è®¡ç®—ä»£ç 
- âœ… è¯†åˆ« ~150 è¡Œé‡å¤å›¾è¡¨æ¸²æŸ“ä»£ç 

#### 1.2 æ–‡æ¡£åˆ›å»º
- âœ… `docs/statsview-refactoring-plan.md` - è¯¦ç»†é‡æ„è®¡åˆ’
- âœ… `docs/statsview-refactoring-status.md` - è¿›åº¦è·Ÿè¸ª
- âœ… æ›´æ–° `docs/pending-issues-checklist.md` - æ ‡è®°ä¸ºè¿›è¡Œä¸­

---

### é˜¶æ®µ 2: æå–ç»Ÿè®¡è®¡ç®— Hooks âœ…

#### 2.1 åˆ›å»ºçš„æ–‡ä»¶

##### `src/hooks/useStatsCalculation.ts` (175 è¡Œ)
**åŠŸèƒ½**: ç»Ÿä¸€çš„æ´»åŠ¨ç»Ÿè®¡è®¡ç®— Hook

**å¯¼å‡ºæ¥å£**:
```typescript
export interface UseStatsCalculationReturn {
  stats: StatsData;                    // å½“å‰å‘¨æœŸç»Ÿè®¡
  previousStats: PreviousStatsData;    // å‰ä¸€å‘¨æœŸç»Ÿè®¡
  filteredLogs: Log[];                 // è¿‡æ»¤åçš„æ—¥å¿—
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- è®¡ç®—æ´»åŠ¨æ€»æ—¶é•¿
- æŒ‰åˆ†ç±»èšåˆç»Ÿè®¡
- æŒ‰æ´»åŠ¨ç»†åˆ†ç»Ÿè®¡
- è®¡ç®—ç™¾åˆ†æ¯”
- æ”¯æŒå‰ä¸€å‘¨æœŸå¯¹æ¯”

**å‡å°‘é‡å¤**: ~100 è¡Œ

##### `src/hooks/useTodoStats.ts` (195 è¡Œ)
**åŠŸèƒ½**: å¾…åŠä¸“æ³¨æ—¶é—´ç»Ÿè®¡ Hook

**å¯¼å‡ºæ¥å£**:
```typescript
export interface UseTodoStatsReturn {
  todoStats: TodoStatsData;                    // å½“å‰å‘¨æœŸå¾…åŠç»Ÿè®¡
  previousTodoStats: PreviousTodoStatsData;    // å‰ä¸€å‘¨æœŸå¾…åŠç»Ÿè®¡
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- è®¡ç®—å¾…åŠæ€»æ—¶é•¿
- æŒ‰å¾…åŠåˆ†ç±»èšåˆ
- æŒ‰å¾…åŠé¡¹ç»†åˆ†
- è‡ªåŠ¨åˆ†é…é¢œè‰²
- æ”¯æŒå‰ä¸€å‘¨æœŸå¯¹æ¯”

**å‡å°‘é‡å¤**: ~100 è¡Œ

##### `src/hooks/useScopeStats.ts` (200 è¡Œ)
**åŠŸèƒ½**: é¢†åŸŸä¸“æ³¨æ—¶é—´ç»Ÿè®¡ Hookï¼ˆæ”¯æŒå¤šé¢†åŸŸåˆ†å‰²ï¼‰

**å¯¼å‡ºæ¥å£**:
```typescript
export interface UseScopeStatsReturn {
  scopeStats: ScopeStatsData;                    // å½“å‰å‘¨æœŸé¢†åŸŸç»Ÿè®¡
  previousScopeStats: PreviousScopeStatsData;    // å‰ä¸€å‘¨æœŸé¢†åŸŸç»Ÿè®¡
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- è®¡ç®—é¢†åŸŸæ€»æ—¶é•¿
- æ”¯æŒå¤šé¢†åŸŸæ—¶é•¿åˆ†å‰²ï¼ˆ1å°æ—¶ log æœ‰ 2 ä¸ª scope = æ¯ä¸ª 30 åˆ†é’Ÿï¼‰
- æŒ‰é¢†åŸŸèšåˆç»Ÿè®¡
- æ´»åŠ¨åˆ†è§£
- æ”¯æŒå‰ä¸€å‘¨æœŸå¯¹æ¯”

**å‡å°‘é‡å¤**: ~100 è¡Œ

#### 2.2 è´¨é‡ä¿è¯
- âœ… æ‰€æœ‰ Hooks é€šè¿‡ TypeScript è¯Šæ–­ï¼ˆ0 é”™è¯¯ï¼‰
- âœ… å®Œæ•´çš„ç±»å‹å®šä¹‰
- âœ… è¯¦ç»†çš„æ–‡æ¡£æ³¨é‡Šï¼ˆ@file, @input, @output, @pos, @descriptionï¼‰
- âœ… ä½¿ç”¨ç¤ºä¾‹

---

### é˜¶æ®µ 3: æå–å›¾è¡¨å·¥å…·å‡½æ•° âœ…

#### 3.1 åˆ›å»ºçš„æ–‡ä»¶

##### `src/utils/chartUtils.ts` (280 è¡Œ)
**åŠŸèƒ½**: å›¾è¡¨æ¸²æŸ“å·¥å…·å‡½æ•°é›†åˆ

**å¯¼å‡ºå‡½æ•°**:

1. **`calculatePieChartPath()`** - è®¡ç®—é¥¼å›¾ SVG è·¯å¾„
   ```typescript
   calculatePieChartPath(percentage: number, currentAngle: number, options?)
   // è¿”å›: { d: string, startAngle: number, endAngle: number }
   ```

2. **`calculatePieChartPaths()`** - æ‰¹é‡è®¡ç®—é¥¼å›¾è·¯å¾„
   ```typescript
   calculatePieChartPaths(percentages: number[], options?)
   // è¿”å›: PieChartPathData[]
   ```

3. **`getHexColor()`** - Tailwind ç±»åè½¬åå…­è¿›åˆ¶é¢œè‰²
   ```typescript
   getHexColor('text-red-500')  // '#fca5a5'
   ```

4. **`getScheduleStyle()`** - è·å–æ—¥ç¨‹è§†å›¾æ ·å¼ç±»å
   ```typescript
   getScheduleStyle('text-red-500')
   // 'bg-red-100/90 text-red-700 border-red-200'
   ```

5. **`formatDuration()`** - æ ¼å¼åŒ–æ—¶é•¿
   ```typescript
   formatDuration(3665)  // '1å°æ—¶ 1åˆ†é’Ÿ'
   ```

6. **`secondsToHoursMinutes()`** - ç§’æ•°è½¬å°æ—¶åˆ†é’Ÿå¯¹è±¡
   ```typescript
   secondsToHoursMinutes(3665)  // { h: 1, m: 1 }
   ```

7. **`getLineChartColor()`** - è·å–æŠ˜çº¿å›¾é¢œè‰²
   ```typescript
   getLineChartColor('text-red-500')  // '#fca5a5'
   ```

8. **`generateLineChartPath()`** - ç”ŸæˆæŠ˜çº¿å›¾ SVG è·¯å¾„
   ```typescript
   generateLineChartPath(dataPoints, getX, getY)
   // 'M 0 80 L 10 60 L 20 40 ...'
   ```

9. **`calculateYAxisMax()`** - è®¡ç®— Y è½´æœ€å¤§å€¼
   ```typescript
   calculateYAxisMax([[1, 2, 3], [4, 5, 6]])  // 6
   ```

#### 3.2 è´¨é‡ä¿è¯
- âœ… é€šè¿‡ TypeScript è¯Šæ–­ï¼ˆ0 é”™è¯¯ï¼‰
- âœ… å®Œæ•´çš„ç±»å‹å®šä¹‰
- âœ… è¯¦ç»†çš„æ–‡æ¡£æ³¨é‡Š
- âœ… ä½¿ç”¨ç¤ºä¾‹

**å‡å°‘é‡å¤**: ~150 è¡Œ

---

## ğŸ“Š æˆæœç»Ÿè®¡

### æ–°å¢æ–‡ä»¶
| æ–‡ä»¶ | è¡Œæ•° | ç±»å‹ | çŠ¶æ€ |
|------|------|------|------|
| useStatsCalculation.ts | 175 | Hook | âœ… |
| useTodoStats.ts | 195 | Hook | âœ… |
| useScopeStats.ts | 200 | Hook | âœ… |
| chartUtils.ts | 280 | Utility | âœ… |
| **æ€»è®¡** | **850** | | |

### ä»£ç è´¨é‡
- **TypeScript é”™è¯¯**: 0
- **æ–‡æ¡£æ³¨é‡Šè¦†ç›–ç‡**: 100%
- **ç±»å‹å®šä¹‰å®Œæ•´æ€§**: 100%
- **å¯å¤ç”¨æ€§**: â­â­â­â­â­

### é¢„æœŸå‡å°‘é‡å¤ä»£ç 
- **ç»Ÿè®¡è®¡ç®—é‡å¤**: ~300 è¡Œ â†’ 0 è¡Œ âœ…
- **å›¾è¡¨å·¥å…·é‡å¤**: ~150 è¡Œ â†’ 0 è¡Œ âœ…
- **æ€»è®¡å‡å°‘**: ~450 è¡Œé‡å¤ä»£ç 

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### é˜¶æ®µ 4: æ‹†åˆ†è§†å›¾ç»„ä»¶ï¼ˆå‰©ä½™å·¥ä½œï¼‰

éœ€è¦åˆ›å»ºçš„ç»„ä»¶ï¼š

1. **`src/components/stats/PieChartView.tsx`** (çº¦ 300 è¡Œ)
   - ç¯å½¢å›¾è§†å›¾ï¼ˆæ´»åŠ¨/å¾…åŠ/é¢†åŸŸåˆ†å¸ƒï¼‰
   - ä½¿ç”¨æ–°çš„ Hooks å’Œå·¥å…·å‡½æ•°

2. **`src/components/stats/MatrixView.tsx`** (çº¦ 200 è¡Œ)
   - çŸ©é˜µå›¾è§†å›¾ï¼ˆæ´»åŠ¨ä¸€è‡´æ€§ï¼‰

3. **`src/components/stats/ScheduleView.tsx`** (çº¦ 300 è¡Œ)
   - æ—¥ç¨‹è§†å›¾ï¼ˆæ—¥/å‘¨/æœˆï¼‰

4. **`src/components/stats/LineChartView.tsx`** (çº¦ 200 è¡Œ)
   - æŠ˜çº¿å›¾è§†å›¾ï¼ˆè¶‹åŠ¿åˆ†æï¼‰

5. **`src/components/stats/CheckView.tsx`** (çº¦ 200 è¡Œ)
   - æ—¥è¯¾æ‰“å¡è§†å›¾ï¼ˆä¹ æƒ¯è¿½è¸ªï¼‰

**é¢„è®¡æ–°å¢**: ~1200 è¡Œï¼ˆç‹¬ç«‹ç»„ä»¶ï¼‰

### é˜¶æ®µ 5: é‡æ„ä¸»æ–‡ä»¶ï¼ˆæœ€åä¸€æ­¥ï¼‰

- æ›´æ–° StatsView.tsx ä½¿ç”¨æ–° Hooks å’Œç»„ä»¶
- åˆ é™¤æ—§çš„ç»Ÿè®¡è®¡ç®—ä»£ç 
- åˆ é™¤æ—§çš„å›¾è¡¨æ¸²æŸ“ä»£ç 
- ç®€åŒ–ä¸ºè§†å›¾åˆ‡æ¢å’Œå¸ƒå±€ç®¡ç†

**é¢„è®¡å‡å°‘**: 2039 â†’ 200-300 è¡Œ (-85%)

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. ç»Ÿä¸€çš„ç»Ÿè®¡è®¡ç®—æ¨¡å¼
æ‰€æœ‰ç»Ÿè®¡ Hooks éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š
- è¿‡æ»¤æ—¥å¿— â†’ è®¡ç®—æ—¶é•¿ â†’ èšåˆåˆ†ç±» â†’ è®¡ç®—ç™¾åˆ†æ¯” â†’ æ’åº
- æ”¯æŒå‰ä¸€å‘¨æœŸå¯¹æ¯”
- å®Œæ•´çš„ç±»å‹å®‰å…¨

### 2. å¯å¤ç”¨çš„å›¾è¡¨å·¥å…·
- çº¯å‡½æ•°è®¾è®¡ï¼Œæ— å‰¯ä½œç”¨
- æ”¯æŒè‡ªå®šä¹‰é…ç½®
- æ˜“äºæµ‹è¯•

### 3. æ¸…æ™°çš„æ¥å£è®¾è®¡
- æ¯ä¸ª Hook éƒ½æœ‰æ˜ç¡®çš„è¾“å…¥è¾“å‡º
- ä½¿ç”¨ TypeScript æ¥å£å®šä¹‰æ•°æ®ç»“æ„
- ä¾¿äºç†è§£å’Œç»´æŠ¤

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### æš‚æœªä¿®æ”¹ StatsView.tsx
- åŸæ–‡ä»¶ä¿æŒä¸å˜
- ç­‰å¾…é˜¶æ®µ 4-5 å®Œæˆåå†æ•´åˆ
- é™ä½é£é™©ï¼Œç¡®ä¿åŠŸèƒ½ä¸å—å½±å“

### éœ€è¦åç»­æµ‹è¯•
- æ–° Hooks éœ€è¦åœ¨å®é™…ä½¿ç”¨ä¸­éªŒè¯
- ç¡®ä¿è®¡ç®—ç»“æœä¸åŸé€»è¾‘ä¸€è‡´
- æ€§èƒ½æµ‹è¯•

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- ğŸ“„ **é‡æ„è®¡åˆ’**: `docs/statsview-refactoring-plan.md`
- ğŸ“„ **è¿›åº¦è·Ÿè¸ª**: `docs/statsview-refactoring-status.md`
- ğŸ“„ **å¾…è§£å†³é—®é¢˜**: `docs/pending-issues-checklist.md`
- ğŸ“„ **ä»£ç å®¡æŸ¥**: `docs/code-review-batch25-views-analysis.md`

---

**çŠ¶æ€**: âœ… é˜¶æ®µ 1-3 å®Œæˆï¼Œå‡†å¤‡è¿›å…¥é˜¶æ®µ 4  
**ä¸‹ä¸€æ­¥**: åˆ›å»ºç¬¬ä¸€ä¸ªè§†å›¾ç»„ä»¶ï¼ˆPieChartView.tsxï¼‰æˆ–ç­‰å¾…ç”¨æˆ·æŒ‡ç¤º
