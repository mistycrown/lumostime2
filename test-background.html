<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Background Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        .test-container {
            width: 300px;
            height: 200px;
            border: 2px solid #ccc;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
        }
        #timeline-content {
            background-color: #f0f0f0;
        }
        #memoir-content {
            background-color: #e0e0e0;
        }
        #scopes-content {
            background-color: #d0d0d0;
        }
        #tags-content {
            background-color: #c0c0c0;
        }
        #chronicle-content {
            background-color: #b0b0b0;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Background Service Test</h1>
    
    <div class="controls">
        <button onclick="testDefault()">Default</button>
        <button onclick="testSunset()">Sunset Gradient</button>
        <button onclick="testOcean()">Ocean Gradient</button>
        <button onclick="testOpacity()">Change Opacity</button>
    </div>
    
    <div class="test-container" id="timeline-content">
        <h3>Timeline Content</h3>
        <p>This should show background when applied</p>
    </div>
    
    <div class="test-container" id="memoir-content">
        <h3>Memoir Content</h3>
        <p>This should show background when applied</p>
    </div>
    
    <div class="test-container" id="scopes-content">
        <h3>Scopes Content</h3>
        <p>This should show background when applied</p>
    </div>
    
    <div class="test-container" id="tags-content">
        <h3>Tags Content</h3>
        <p>This should show background when applied</p>
    </div>
    
    <div class="test-container" id="chronicle-content">
        <h3>Chronicle Content</h3>
        <p>This should show background when applied</p>
    </div>

    <script>
        // Mock background service for testing
        const backgroundService = {
            setCurrentBackground: function(id) {
                localStorage.setItem('lumos_current_background', id);
                this.applyBackgroundToElements();
            },
            
            setBackgroundOpacity: function(opacity) {
                localStorage.setItem('lumos_background_opacity', opacity.toString());
                this.applyBackgroundToElements();
            },
            
            getCurrentBackground: function() {
                return localStorage.getItem('lumos_current_background') || 'default';
            },
            
            getBackgroundOpacity: function() {
                const stored = localStorage.getItem('lumos_background_opacity');
                return stored ? parseFloat(stored) : 0.8;
            },
            
            getCurrentBackgroundOption: function() {
                const currentId = this.getCurrentBackground();
                const backgrounds = {
                    'default': { id: 'default', url: '' },
                    'gradient-sunset': { id: 'gradient-sunset', url: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%)' },
                    'gradient-ocean': { id: 'gradient-ocean', url: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }
                };
                return backgrounds[currentId] || null;
            },
            
            applyBackgroundToElements: function() {
                const background = this.getCurrentBackgroundOption();
                const opacity = this.getBackgroundOpacity();
                
                console.log('Applying background:', { background: background?.id, opacity });
                
                const targetElements = [
                    'timeline-content',
                    'memoir-content', 
                    'scopes-content',
                    'tags-content',
                    'chronicle-content'
                ];
                
                targetElements.forEach(elementId => {
                    const element = document.getElementById(elementId);
                    if (!element) {
                        console.log(`Element not found: ${elementId}`);
                        return;
                    }
                    
                    // Clear previous styles
                    element.style.removeProperty('background');
                    element.style.removeProperty('background-image');
                    element.style.removeProperty('background-size');
                    element.style.removeProperty('background-position');
                    element.style.removeProperty('background-repeat');
                    element.style.removeProperty('opacity');
                    
                    if (!background || background.id === 'default') {
                        console.log(`Removing background from ${elementId}`);
                        return;
                    }
                    
                    if (background.url.startsWith('linear-gradient')) {
                        console.log(`Applying gradient background to ${elementId}`);
                        element.style.background = background.url;
                        element.style.opacity = opacity.toString();
                    } else {
                        console.log(`Applying image background to ${elementId}`);
                        element.style.backgroundImage = `url(${background.url})`;
                        element.style.backgroundSize = 'cover';
                        element.style.backgroundPosition = 'center';
                        element.style.backgroundRepeat = 'no-repeat';
                        element.style.opacity = opacity.toString();
                    }
                });
            }
        };
        
        function testDefault() {
            backgroundService.setCurrentBackground('default');
        }
        
        function testSunset() {
            backgroundService.setCurrentBackground('gradient-sunset');
        }
        
        function testOcean() {
            backgroundService.setCurrentBackground('gradient-ocean');
        }
        
        function testOpacity() {
            const current = backgroundService.getBackgroundOpacity();
            const newOpacity = current > 0.5 ? 0.3 : 0.9;
            backgroundService.setBackgroundOpacity(newOpacity);
        }
        
        // Initialize
        setTimeout(() => {
            backgroundService.applyBackgroundToElements();
        }, 100);
    </script>
</body>
</html>